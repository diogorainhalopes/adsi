<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Slides
More Tuning Index Tuning Topics
 Types of queries Index structure Clustered vs. non clustered indexes Covering/composite indexes Indexes on small tables Recommendations  Types of Queries  Point Query  1 2 3  SELECTnameFROMEmployeeWHEREssnum=8478:  Multipoint Query (Index tuning is especially usefull to reduce disk accesses on non clusteres indexes)  1 2 3  SELECTnameFROMEmployeeWHEREdept='Information Systems';  Range Query  1 2 3 4  SELECTnameFROMEmployeeWHEREsalary>=40000ANDsalary<60000;  Prefix Match Query  1 2 3  SELECT*FROMEmployeeWHEREnameLIKE'Ke%';  Extremal Query (in a B+ Tree you would only need to follow the rightmost path)  1 2 3  SELECTnameFROMEmployeeWHEREsalary=(SELECTMAX(salary)FROMEmployee);  Ordering Query  1 2 3  SELECT*FROMEmployeeORDERBYsalary;  Grouping Query (using HASH if no index is available)  1 2 3  SELECTdept,AVG(salary)FROMEmployeeGROUPBYdept;  Join Query (Prevent nested loops)  1 2 3 4  SELECTe1."><meta property="og:title" content="Lecture 10 - Tuning (continued)"><meta property="og:description" content="Slides
More Tuning Index Tuning Topics
 Types of queries Index structure Clustered vs. non clustered indexes Covering/composite indexes Indexes on small tables Recommendations  Types of Queries  Point Query  1 2 3  SELECTnameFROMEmployeeWHEREssnum=8478:  Multipoint Query (Index tuning is especially usefull to reduce disk accesses on non clusteres indexes)  1 2 3  SELECTnameFROMEmployeeWHEREdept='Information Systems';  Range Query  1 2 3 4  SELECTnameFROMEmployeeWHEREsalary>=40000ANDsalary<60000;  Prefix Match Query  1 2 3  SELECT*FROMEmployeeWHEREnameLIKE'Ke%';  Extremal Query (in a B+ Tree you would only need to follow the rightmost path)  1 2 3  SELECTnameFROMEmployeeWHEREsalary=(SELECTMAX(salary)FROMEmployee);  Ordering Query  1 2 3  SELECT*FROMEmployeeORDERBYsalary;  Grouping Query (using HASH if no index is available)  1 2 3  SELECTdept,AVG(salary)FROMEmployeeGROUPBYdept;  Join Query (Prevent nested loops)  1 2 3 4  SELECTe1."><meta property="og:type" content="website"><meta property="og:image" content="https://diogorainhalopes.github.io/adsi/icon.png"><meta property="og:url" content="https://diogorainhalopes.github.io/adsi/Lectures/Lecture-10-Database-Tuning-continued/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lecture 10 - Tuning (continued)"><meta name=twitter:description content="Slides
More Tuning Index Tuning Topics
 Types of queries Index structure Clustered vs. non clustered indexes Covering/composite indexes Indexes on small tables Recommendations  Types of Queries  Point Query  1 2 3  SELECTnameFROMEmployeeWHEREssnum=8478:  Multipoint Query (Index tuning is especially usefull to reduce disk accesses on non clusteres indexes)  1 2 3  SELECTnameFROMEmployeeWHEREdept='Information Systems';  Range Query  1 2 3 4  SELECTnameFROMEmployeeWHEREsalary>=40000ANDsalary<60000;  Prefix Match Query  1 2 3  SELECT*FROMEmployeeWHEREnameLIKE'Ke%';  Extremal Query (in a B+ Tree you would only need to follow the rightmost path)  1 2 3  SELECTnameFROMEmployeeWHEREsalary=(SELECTMAX(salary)FROMEmployee);  Ordering Query  1 2 3  SELECT*FROMEmployeeORDERBYsalary;  Grouping Query (using HASH if no index is available)  1 2 3  SELECTdept,AVG(salary)FROMEmployeeGROUPBYdept;  Join Query (Prevent nested loops)  1 2 3 4  SELECTe1."><meta name=twitter:image content="https://diogorainhalopes.github.io/adsi/icon.png"><title>Lecture 10 - Tuning (continued)</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://diogorainhalopes.github.io/adsi//icon.png><link href=https://diogorainhalopes.github.io/adsi/styles.b369a84b3c6e6bfd686ad1f9da65641c.min.css rel=stylesheet><link href=https://diogorainhalopes.github.io/adsi/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://diogorainhalopes.github.io/adsi/js/darkmode.8f4577ddc9f8f98224343bd749bb237a.min.js></script>
<script src=https://diogorainhalopes.github.io/adsi/js/util.a0ccf91e1937fe761a74da4946452710.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script async src=https://diogorainhalopes.github.io/adsi/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://diogorainhalopes.github.io/adsi/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://diogorainhalopes.github.io/adsi/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://diogorainhalopes.github.io/adsi/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://diogorainhalopes.github.io/adsi/",fetchData=Promise.all([fetch("https://diogorainhalopes.github.io/adsi/indices/linkIndex.c1e2c54552594d3ea5fc49c6df461c3a.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://diogorainhalopes.github.io/adsi/indices/contentIndex.2db74e81a21202134dfee55ffd371055.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://diogorainhalopes.github.io/adsi",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://diogorainhalopes.github.io/adsi",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:2,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:2,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}function i(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const a=document.querySelectorAll("a");for(link of a)link.className.includes("root-title")&&link.addEventListener("click",i,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/diogorainhalopes.github.io\/adsi\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=diogorainhalopes.github.io/adsi src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://diogorainhalopes.github.io/adsi/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://diogorainhalopes.github.io/adsi/>ADSI Notes - Diogo Lopes</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Lecture 10 - Tuning (continued)</h1><p class=meta>Last updated
Mar 24, 2023</p><ul class=tags></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#index-tuning>Index Tuning</a><ol><li><a href=#types-of-queries>Types of Queries</a></li><li><a href=#index-structure>Index Structure</a></li><li><a href=#clustered-vs-non-clustered-indexes>Clustered vs. non-clustered indexes</a></li><li><a href=#coveringcomposite-indexes>Covering/composite indexes</a></li><li><a href=#indexes-on-small-tables>Indexes on small tables</a></li><li><a href=#notes>Notes</a></li><li><a href=#optimizing-workloads>Optimizing workloads</a></li></ol></li><li><a href=#lock-and-log-tuning>Lock and log tuning</a><ol><li><a href=#log-tuning>Log tuning</a></li><li><a href=#lock-tuning>Lock tuning</a></li></ol></li></ol></nav></details></aside><p><a href=https://diogorainhalopes.github.io/adsi/slides/adsi-09-tuning.pdf rel=noopener>Slides</a></p><a href=#more-tuning><h1 id=more-tuning><span class=hanchor arialabel=Anchor># </span>More Tuning</h1></a><a href=#index-tuning><h2 id=index-tuning><span class=hanchor arialabel=Anchor># </span>Index Tuning</h2></a><p>Topics</p><ul><li>Types of queries</li><li>Index structure</li><li>Clustered vs. non clustered indexes</li><li>Covering/composite indexes</li><li>Indexes on small tables</li><li>Recommendations</li></ul><a href=#types-of-queries><h3 id=types-of-queries><span class=hanchor arialabel=Anchor># </span>Types of Queries</h3></a><ol><li>Point Query</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>ssnum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>8478</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=2><li>Multipoint Query (Index tuning is especially usefull to reduce disk accesses on non clusteres indexes)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>dept</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Information Systems&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=3><li>Range Query</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>salary</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>40000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>AND</span><span class=w> </span><span class=n>salary</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>60000</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=4><li>Prefix Match Query</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;Ke%&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=5><li>Extremal Query (in a B+ Tree you would only need to follow the rightmost path)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>salary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>MAX</span><span class=p>(</span><span class=n>salary</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=6><li>Ordering Query</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>salary</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=7><li>Grouping Query (using HASH if no index is available)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>dept</span><span class=p>,</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>salary</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>dept</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=8><li>Join Query (Prevent nested loops)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>e1</span><span class=p>.</span><span class=n>ssnum</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=w> </span><span class=n>e1</span><span class=p>,</span><span class=w> </span><span class=n>Employee</span><span class=w> </span><span class=n>e2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>e1</span><span class=p>.</span><span class=n>manager</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e2</span><span class=p>.</span><span class=n>ssnum</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>AND</span><span class=w> </span><span class=n>e1</span><span class=p>.</span><span class=n>salary</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>e2</span><span class=p>.</span><span class=n>salary</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><a href=#index-structure><h3 id=index-structure><span class=hanchor arialabel=Anchor># </span>Index Structure</h3></a><p><img src=https://diogorainhalopes.github.io/adsi//assets/index_struct.png width=auto alt></p><a href=#b--tree><h4 id=b--tree><span class=hanchor arialabel=Anchor># </span>B+ -Tree</h4></a><ul><li>Always start from root (Good general purpose index structure)<ul><li>Useful for range queries and extremal queries, where hash indexes are not</li><li>SQL Server mostly uses this</li></ul></li><li>Minimize height by having more children per node<ul><li>Length of search key influences <em><strong>fanout</strong></em> (number of children per node)</li><li>Choose a small key when creating an index</li><li>If the key is large, it may be possible to use key compression<ul><li>store only part of the key to distinguish between neighbors</li><li>e.g. store &rsquo; Smi &lsquo;, Smo &lsquo;, Smy &rsquo; instead of &lsquo;Smith&rsquo;, &lsquo;Smoot&rsquo;, '</li></ul></li></ul></li><li>Log search</li></ul><a href=#hash><h4 id=hash><span class=hanchor arialabel=Anchor># </span>Hash</h4></a><ul><li>Straight to row<ul><li>Faster than B+ -trees for <strong>point</strong> queries and <strong>multipoint</strong> queries</li></ul></li><li>UNLESS overflow buckets<ul><li>Must be reorganized if there is a significant amount of overflow</li></ul></li><li>Size of hash structure is not related to length of search key<ul><li>hash function is applied on key to locate bucket with pointers</li></ul></li></ul><a href=#clustered-vs-non-clustered-indexes><h3 id=clustered-vs-non-clustered-indexes><span class=hanchor arialabel=Anchor># </span>Clustered vs. non-clustered indexes</h3></a><p>Clustered index</p><ul><li>Co-locates records whose values are near to one another<ul><li>For B+-trees, two values are near if they are close in sort order<ul><li>Good for point, multipoint, partial match, general join queries</li></ul></li><li>For hash indexes, two values are near only if they are identical<ul><li>Good for point, multipoint, equijoin queries</li></ul></li></ul></li><li>Non-clustered index<ul><li>A non-clustered index is independent of the table organization</li><li>There may be several non-clustered indexes per table</li></ul></li></ul><p><img src=https://diogorainhalopes.github.io/adsi//assets/clustvsnonclus.png width=auto alt>
Clustered indexes can be dense or sparse</p><ul><li><strong>Dense index</strong><ul><li>pointers are associated to records; one index entry per record</li></ul></li><li><strong>Sparse index</strong><ul><li>pointers are associated to pages; one index entry per page</li><li>any values 𝑣1≤𝑣&lt;𝑣2can be found on the same page as 𝑣1</li></ul></li><li><strong>Non clustered indexes must be dense</strong><ul><li>cannot be sparse, since values 𝑣1≤𝑣&lt;𝑣2can be anywhere</li></ul></li></ul><a href=#benefits-of-a-clustered-index><h4 id=benefits-of-a-clustered-index><span class=hanchor arialabel=Anchor># </span>Benefits of a Clustered Index</h4></a><ul><li>A sparse clustered index stores fewer pointers than a dense index (Less height in B+-Tree)</li><li>A clustered index is good for multipoint queries</li><li>A clustered index can improve equality joins</li></ul><a href=#evaluation-of-clustered-indexes-with-insertions><h5 id=evaluation-of-clustered-indexes-with-insertions><span class=hanchor arialabel=Anchor># </span>Evaluation of Clustered Indexes with Insertions</h5></a><ul><li>Insertions cause page splits and extra I/O for each query</li><li><strong>Maintenance</strong> consists in rebuilding or reorganizing the index<ul><li>With maintenance, performance is constant</li><li>Without maintenance, performance degrades</li></ul></li></ul><a href=#redundant-tables><h5 id=redundant-tables><span class=hanchor arialabel=Anchor># </span>Redundant Tables</h5></a><ul><li>There can be only one clustered index per table</li><li><strong>Question</strong>: Wouldn&rsquo;t it be nice to have multiple clustered indexes?</li><li><strong>Answer</strong>:<ul><li>Replicate table to use a clustered index on a different attribute</li><li>Works well only if low insertion/update rate</li></ul></li></ul><a href=#benefits-of-non-clustered-indexes><h4 id=benefits-of-non-clustered-indexes><span class=hanchor arialabel=Anchor># </span>Benefits of Non-clustered Indexes</h4></a><p>A non-clustered index is good if the query retrieves few records compared to the number of pages in the table</p><ul><li>Always useful for point queries</li><li>Useful for multipoint queries if table contains many distinct values</li><li>In an experiment was observed that an index is good if query selectivity &lt; 15% of records
At some point, a table scan becomes better than using a non-clusters index</li></ul><a href=#covering><h5 id=covering><span class=hanchor arialabel=Anchor># </span>Covering</h5></a><p>A non-clustered index can eliminate the need to access the underlying table through <strong>covering</strong></p><ul><li>Example:</li><li>with a <strong>composite index</strong> on ( A , B , C ) or</li><li>with a <strong>covering index</strong> on A that includes B and C</li><li>the query below can be answered based on the index alone</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>R</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>It might be worth creating multiple indexes to increase the likelihood that the optimizer finds a covering index</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Simply put, the covering index contains the data to be searched through include, so that the SQL query can get the required data without reaching the basic table. The composite index is to create an index on the combination of multiple columns, these columns may contain all the columns of the query, or may not contain.
</span></span></code></pre></td></tr></table></div></div><p><img src=https://diogorainhalopes.github.io/adsi//assets/cov_ix_hist.png width=auto alt></p><a href=#coveringcomposite-indexes><h3 id=coveringcomposite-indexes><span class=hanchor arialabel=Anchor># </span>Covering/composite indexes</h3></a><p>A non-clustered index can eliminate the need to access the underlying table through covering or composite index</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>dept</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Information Systems&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>A good covering index would be on ( dept , name )</li><li>Index on ( name , dept ) would be useless</li></ul><p>Drawbacks</p><ul><li>Tends to have a large size</li><li>Update to an attribute causes index to be modified</li></ul><a href=#composite-search-keys><h4 id=composite-search-keys><span class=hanchor arialabel=Anchor># </span>Composite Search Keys</h4></a><p>To retrieve records with <strong>age =30 AND salary =4000</strong></p><ul><li>Index on ( age , salary ) is better than index on age or index on salary</li><li>Index could be clustered or non-clustered
If condition is 20&lt; age &lt;30 AND salary &lt;5000</li><li>Clustered index on ( age , salary ) or salary, age ) is best
If condition is age =30 AND salary &lt;5000</li><li>Clustered index on ( age , salary ) is better than salary, age</li></ul><a href=#indexes-on-small-tables><h3 id=indexes-on-small-tables><span class=hanchor arialabel=Anchor># </span>Indexes on small tables</h3></a><ul><li>Indexes reduce the scope of locks</li><li>Indexes might not be justified when thinking on queries, but on updates or concurrent transation it might bring isolation to those transactions</li></ul><a href=#notes><h3 id=notes><span class=hanchor arialabel=Anchor># </span>Notes</h3></a><ul><li>Use a hash index for equality queries</li><li>Use a B+ tree if equality and non equality queries may be used</li><li>Use clustered indexes if:<ul><li>queries need all (or most) fields in records,</li><li>records are too large for a composite index,</li><li>and multiple records are returned per query</li></ul></li><li>If possible, use a covering index for critical queries</li><li>Do not use index if the time lost inserting and updating overwhelms time saved when querying</li></ul><a href=#optimizing-workloads><h3 id=optimizing-workloads><span class=hanchor arialabel=Anchor># </span>Optimizing workloads</h3></a><ul><li>Modern database systems: <strong>automated tuning wizards</strong></li><li>Provide a workload as input</li><li>Two step approach<ul><li>best index</li><li>best subset of index</li></ul></li><li>Consider both the benefits and the overhead</li></ul><a href=#lock-and-log-tuning><h2 id=lock-and-log-tuning><span class=hanchor arialabel=Anchor># </span>Lock and log tuning</h2></a><a href=#log-tuning><h3 id=log-tuning><span class=hanchor arialabel=Anchor># </span>Log tuning</h3></a><p><img src=https://diogorainhalopes.github.io/adsi//assets/stable_store_data_log.png width=auto alt></p><ul><li>The data disk and log disk should be separate</li></ul><p><strong>Topics</strong></p><ul><li>Put the log on a separate disk</li><li>Delay output to database disks</li><li>Database dumps and checkpoints</li><li>From batch to minibatch transactions</li></ul><p><strong>Tuning the recovery system</strong></p><p><img src=https://diogorainhalopes.github.io/adsi//assets/log_sep_disk.png width=auto alt></p><a href=#lock-tuning><h3 id=lock-tuning><span class=hanchor arialabel=Anchor># </span>Lock tuning</h3></a><a href=#trade-off-between-correctness-and-performance><h4 id=trade-off-between-correctness-and-performance><span class=hanchor arialabel=Anchor># </span>Trade-off between correctness and performance</h4></a><ul><li>Concurrency Control Goals</li><li>Correctness goals</li><li>Serializability: each transaction appears to execute in isolation</li><li>Performance goals<ul><li>Reduce blocking<ul><li>One transaction waits for another to release its locks</li></ul></li><li>Avoid deadlocks<ul><li>Transactions are waiting for each other to release their locks</li></ul></li></ul></li></ul><a href=#ideal-transaction><h4 id=ideal-transaction><span class=hanchor arialabel=Anchor># </span>Ideal Transaction</h4></a><ul><li>Acquires few locks and favors S locks over X locks</li><li>Acquires locks with fine granularity</li><li>Holds locks for a short time</li></ul><a href=#eliminate-unnecessary-locking><h4 id=eliminate-unnecessary-locking><span class=hanchor arialabel=Anchor># </span>Eliminate unnecessary locking</h4></a><p>Locking is not necessary when:</p><ul><li>Only one transaction runs at a time<ul><li>e.g. when loading the database</li></ul></li><li>All transactions are read only<ul><li>e.g. decision support queries on archival database</li></ul></li></ul><p><em><strong>PROJECT RELEVANT</strong></em>
Use available options to <strong>suppress locking</strong></p><ul><li>Choose the appropriate isolation level</li><li>Disable <em><strong>lock escalation</strong></em> (FEW LOCKS GENERATE FULL LOCK OF HIGHER OBJECT)<ul><li>when many row or page locks are converted to a table lock</li></ul></li><li>Use table hints such as <strong>WITH (NOLOCK)</strong></li></ul><a href=#sacrificing-isolation-for-performance><h4 id=sacrificing-isolation-for-performance><span class=hanchor arialabel=Anchor># </span>Sacrificing Isolation for Performance</h4></a><p><img src=https://diogorainhalopes.github.io/adsi//assets/corrvsavail.png width=auto alt></p><a href=#transaction-chopping><h4 id=transaction-chopping><span class=hanchor arialabel=Anchor># </span>Transaction Chopping</h4></a><ul><li>Rule of thumb<ul><li>Suppose <strong>T</strong> accesses data <strong>X</strong> and <strong>Y</strong> , but other transactions access <strong>X</strong> or <strong>Y</strong> and nothing else</li><li>Then <strong>T</strong> can be divided into two transactions, one accessing <strong>X</strong> and another accessing <strong>Y</strong></li></ul></li><li>Caution</li><li>Adding a new transaction to a set of existing transactions may invalidate previous choppings</li></ul><p><img src=https://diogorainhalopes.github.io/adsi//assets/transac_chop.png width=auto alt></p><p><strong>Trade-off</strong>
The consistency of X+Y IS NOT GUARANTEED (create money or make money disappear)
BUT X>=0</p><a href=#why><h5 id=why><span class=hanchor arialabel=Anchor># </span>Why</h5></a><ul><li><strong>Long transactions</strong><ul><li>accessing almost all pages of a table</li><li>should use table locks mostly to avoid deadlocks</li></ul></li><li><strong>Short transactions</strong><ul><li>accessing only a few records of a table</li><li>should use record locks to enhance concurrency</li></ul></li></ul><a href=#hot-spots><h4 id=hot-spots><span class=hanchor arialabel=Anchor># </span>Hot Spots</h4></a><ul><li>Data item accessed by many transactions and updated by some</li><li>e.g. max id in a table to insert a value</li><li>Each update transaction must complete before other transactions can obtain a lock on the item (bottleneck)</li><li><strong>Techniques to circumvent</strong>:<ul><li>Access the item as late as possible in the transaction, to minimize the time that the transaction holds the lock on item</li><li>Use special database management facilities; e.g. use auto increment for sequential <strong>key generation</strong>, instead of counter</li></ul></li></ul><p><img src=https://diogorainhalopes.github.io/adsi//assets/auto_incr.png width=auto alt></p><p><a href=/adsi/Lectures/Lecture-9-Database-Tuning/ rel=noopener class=internal-link data-src=/adsi/Lectures/Lecture-9-Database-Tuning/>Lecture 9 Tuning</a> |</p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/adsi/Lectures/Index-Lecture-Notes/ data-ctx="Lecture 10 Database Tuning (continued)" data-src=/Lectures/Index-Lecture-Notes class=internal-link>Index Lecture Notes</a></li><li><a href=/adsi/Lectures/Lecture-9-Database-Tuning/ data-ctx="Lecture 10 Tuning (continued)" data-src=/Lectures/Lecture-9-Database-Tuning class=internal-link>Lecture 9 - Tuning</a></li></ul></div><div><script async src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://diogorainhalopes.github.io/adsi/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by Diogo Lopes using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://diogorainhalopes.github.io/adsi/>Home</a></li><li><a href=https://github.com/diogorainhalopes>GitHub</a></li></ul></footer></div></div></body></html>